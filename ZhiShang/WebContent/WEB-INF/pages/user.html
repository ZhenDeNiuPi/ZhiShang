<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<link href="css/bootstrap.min.css" rel="stylesheet">
	<title>首页</title>
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/bootstrap-treeview.min.css" rel="stylesheet">
    <link href="css/bootstrap-dialog.css" rel="stylesheet">
    <script type="text/javascript" src="js/bootstrap.min.js"></script>
    <script type="text/javascript" src="js/bootstrap-table.js"></script>
    <script type="text/javascript" src="js/bootstrap-treeview.min.js"></script>
    <script type="text/javascript" src="js/bootstrap-dialog.js"></script>
    <script type="text/javascript" src="js/bootstrap-datetimepicker.min.js"></script>
    <script type="text/javascript" src="js/properties.js"></script>
    <script type="text/javascript" src="js/globalAjax.js"></script>
    <style>
    .modal-dialog {
	    width: 800px;
	    margin: 30px auto;
	}
    </style>
</head>
<body>
    <div id="toolbar">
        <button id="condis" class="btn btn-warning" data-toggle="modal"
		             data-target="#searchModal">
            <i class="glyphicon glyphicon-search"></i> 条件查询
        </button>
        <button id="clear" class="btn btn-primary">
            <i class="glyphicon glyphicon-refresh"></i> 重置查询
        </button>
    </div>
    <table id="table" data-toolbar="#toolbar">
    </table>
</div>
	<div class="modal fade" id="searchModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	  <div class="modal-dialog">
	    <div class="modal-content">
	      <div class="modal-header">
	        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
	        <h4 class="modal-title" id="myModalLabel"
	        align="center">条件查询</h4>
	      </div>
	      <div class="modal-body">
	       	<!-- 表单开始 -->
			<form id="searchForm" action="" class="form-horizontal" role="form">
			 <div class="form-group">
			    <label for="timeStrBegin" class="col-sm-3 control-label">注册时间起始</label>
			    <div class="col-sm-3">
			      <input type="text" class="form-control"
			       id="timeStrBegin" name="timeStrBegin" readonly="readonly"  placeholder="选择时间起始">
			    </div>
			    <label for="timeStrBegin" class="col-sm-3 control-label">注册时间截止</label>
			    <div class="col-sm-3">
			      <input type="text" class="form-control"
			       id="timeStrEnd" name="timeStrEnd" readonly="readonly"  placeholder="选择时间截止">
			    </div>
			  </div>
			 <div class="form-group">
			    <label for="timeStrBegin" class="col-sm-3 control-label">上次登录时间起始</label>
			    <div class="col-sm-3">
			      <input type="text" class="form-control"
			       id="timeStrBegin2" name="timeStrBegin2" readonly="readonly"  placeholder="选择时间起始">
			    </div>
			    <label for="timeStrBegin" class="col-sm-3 control-label">上次登录时间截止</label>
			    <div class="col-sm-3">
			      <input type="text" class="form-control"
			       id="timeStrEnd2" name="timeStrEnd2" readonly="readonly"  placeholder="选择时间截止">
			    </div>
			  </div>
			  <div class="form-group">
			    <label for="searchEmailOrName" class="col-sm-3 control-label">邮箱昵称模糊检索</label>
			    <div class="col-sm-9">
			      <input type="text" class="form-control"
			       id="searchEmailOrName" name="searchEmailOrName"  placeholder="输入用户邮箱或昵称" maxlength="15"/>
			    </div>
			  </div>
			</form>
	       	<!-- 表单结束 -->
	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
	        <button type="button" id="clearButton" class="btn btn-primary">重置</button>
	        <button type="button" id="searchButton" class="btn btn-primary">查询</button>
	      </div>
	    </div>
	  </div>
	</div>
	<div class="modal fade" id="fundModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	  <div class="modal-dialog" style="width:90%;">
	    <div class="modal-content">
	      <div class="modal-header">
	        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
	        <h4 class="modal-title" id="myModalLabel"
	        align="center">用户订阅信息</h4>
	      </div>
	      <div class="modal-body">
		    <table id="fundTable" data-toolbar="#toolbar2">
		    </table>
	      </div>
	    </div>
	  </div>
	</div>
	<div class="modal fade" id="orderModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	  <div class="modal-dialog" style="width:90%;">
	    <div class="modal-content">
	      <div class="modal-header">
	        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
	        <h4 class="modal-title" id="myModalLabel"
	        align="center">用户续费信息</h4>
	      </div>
	      <div class="modal-body">
		    <table id="orderTable" data-toolbar="#toolbar2">
		    </table>
	      </div>
	    </div>
	  </div>
	</div>
</body>
<script type="text/javascript">
var userid = null;
function queryParams(params) {  //配置参数 
	var temp = {   //这里的键的名字和控制器的变量名必须一直，这边改动，控制器也需要改成一样的  
  	"pageSize": params.pageSize,   //页面大小  
 	"pageNumber": params.pageNumber,  //页码    
	"u.email`u.username%s~":$("#searchEmailOrName").val(),
	"reg_time%t>":$("#timeStrBegin").val(),
	"reg_time%t<":$("#timeStrEnd").val(),
	"last_login_time%t>":$("#timeStrBegin2").val(),
	"last_login_time%t<":$("#timeStrEnd2").val(),
  	"sortName": params.sortName,  //排序列名  
  	"sortOrder": params.sortOrder//排位命令（desc，asc）  
};  
return temp;  
} 
    $("#clearButton").bind("click",function(){
    	document.getElementById("searchForm").reset();
    });
    $("#clear").bind("click",function(){
    	document.getElementById("searchForm").reset();
    	$("#table").bootstrapTable(  
	              "refresh",  
	              {  
	                  url:"user/getDatas"
	              }  
	      ); 
    });
    $("#searchButton").bind("click",function(){
    	
    	$("#table").bootstrapTable(  
	              "refresh",  
	              {   
	                  url:"user/getDatas"
	              }  
	      ); 
		$("#searchModal").modal('hide');
    });
$('#table').bootstrapTable({
    method: 'post',
    contentType: "application/x-www-form-urlencoded",
    url: "user/getDatas",//这个接口需要处理bootstrap table传递的固定参数
    toolbar: '#toolbar',    //工具按钮用哪个容器
    striped: true,      //是否显示行间隔色
    cache: false,      //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
    pagination: true,     //是否显示分页（*）
    onlyInfoPagination: false,
    sortable: true,      //是否启用排序
    sortOrder: "desc",     //排序方式
    sortName:"id",
    dataType: "json",
    pageNumber:1,      //初始化加载第一页，默认第一页
    pageSize: 10,      //每页的记录行数（*）
    pageList: [10, 25, 50, 100],  //可供选择的每页的行数（*）
    queryParamsType:'', //默认值为 'limit' ,在默认情况下 传给服务端的参数为：offset,limit,sort
                        // 设置为 ''  在这种情况下传给服务器的参数为：pageSize,pageNumber

    queryParams: queryParams,//前端调用服务时，会默认传递上边提到的参数，如果需要添加自定义参数，可以自定义一个函数返回请求参数
    sidePagination: "server",   //分页方式：client客户端分页，server服务端分页（*）
    //search: true,      //是否显示表格搜索，此搜索是客户端搜索，不会进服务端，所以，个人感觉意义不大
    //strictSearch: true,
    //showColumns: true,     //是否显示所有的列
    //showRefresh: true,     //是否显示刷新按钮
    //showHeader : true,
    //showPaginationSwitch:true,
    //showColumns : true,
    minimumCountColumns: 2,    //最少允许的列数
    clickToSelect: false,    //是否启用点击选中行
    //searchOnEnterKey: true,
    /* height: $(window).height(), */
    columns: [{
        field: 'id',
        title: 'id',
        align: 'center',
        visible:false
    },{
        field: 'email',
        title: '邮箱',
        align: 'center',
        width:'10%',
        sortable: true
    },{
        field: 'username',
        title: '昵称',
        align: 'center',
        width:'10%',
        sortable: true
    },{
        field: 'rtime',
        title: '注册时间',
        align: 'center',
        width:'10%',
        sortable: true
    },{
        field: 'ltime',
        title: '上次登录时间',
        align: 'center',
        width:'10%',
        sortable: true
    },{
        field: 'level',
        title: '剩余天数',
        align: 'center',
        width:'10%',
        sortable: true
    },{
        field: 'dcount',
        title: '订阅数量',
        align: 'center',
        width:'10%',
        sortable: true,
        formatter: function (value, row, index) {
        	//后续做成可点击
        	if(value>0)
        		return "<a href='#' onclick='openUserFund("+row["id"]+")'>"+value+"</a>";
        	return value;
        }
    },{
        field: 'ocount',
        title: '续费次数',
        align: 'center',
        width:'10%',
        sortable: true,
        formatter: function (value, row, index) {
        	//后续做成可点击
        	if(value>0)
        		return "<a href='#' onclick='openUserOrder("+row["id"]+")'>"+value+"</a>";
        	return value;
        }
    } ],
    onLoadSuccess:function(data){
    	/* console.log($("#footpagebar"));
    	$("#footpagebar").attr("style","margin:0 auto"); */
    }
});

function openUserFund(user_id){
	userid = user_id;
	$("#fundTable").bootstrapTable(  
            "refresh",  
            {  
                url:"followfund/getDatas4Manager"
            }  
    );
	$("#fundModal").modal('show');
}

function openUserOrder(user_id){
	userid = user_id;
	$("#orderTable").bootstrapTable(  
            "refresh",  
            {  
                url:"order/getAllDatas"
            }  
    );
	$("#orderModal").modal('show');
}

$('#timeStrBegin').datetimepicker({
	format: 'yyyy-mm-dd',      /*此属性是显示顺序，还有显示顺序是mm-dd-yyyy*/
	minView:'month',
	todayBtn:true,
	todayHighlight:true,
	autoclose:true,
	startDate:'2018-01-01',
	forceParse:false
	});
$('#timeStrEnd').datetimepicker({
	format: 'yyyy-mm-dd',      /*此属性是显示顺序，还有显示顺序是mm-dd-yyyy*/
	minView:'month',
	todayBtn:true,
	todayHighlight:true,
	autoclose:true,
	startDate:'2018-01-01',
	forceParse:false
	});
$('#timeStrBegin2').datetimepicker({
	format: 'yyyy-mm-dd',      /*此属性是显示顺序，还有显示顺序是mm-dd-yyyy*/
	minView:'month',
	todayBtn:true,
	todayHighlight:true,
	autoclose:true,
	startDate:'2018-01-01',
	forceParse:false
	});
$('#timeStrEnd2').datetimepicker({
	format: 'yyyy-mm-dd',      /*此属性是显示顺序，还有显示顺序是mm-dd-yyyy*/
	minView:'month',
	todayBtn:true,
	todayHighlight:true,
	autoclose:true,
	startDate:'2018-01-01',
	forceParse:false
	});
	
$('#fundTable').bootstrapTable({
    method: 'post',
    contentType: "application/x-www-form-urlencoded",
    url: "followfund/getDatas4Manager",//这个接口需要处理bootstrap table传递的固定参数
    toolbar: '#toolbar2',    //工具按钮用哪个容器
    striped: true,      //是否显示行间隔色
    cache: false,      //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
    pagination: true,     //是否显示分页（*）
    onlyInfoPagination: false,
    sortable: true,      //是否启用排序
    sortOrder: "desc",     //排序方式
    sortName:"follow_time",
    dataType: "json",
    pageNumber:1,      //初始化加载第一页，默认第一页
    pageSize: 10,      //每页的记录行数（*）
    pageList: [10, 25, 50, 100],  //可供选择的每页的行数（*）
    queryParamsType:'', //默认值为 'limit' ,在默认情况下 传给服务端的参数为：offset,limit,sort
                        // 设置为 ''  在这种情况下传给服务器的参数为：pageSize,pageNumber

    queryParams: queryParams2,//前端调用服务时，会默认传递上边提到的参数，如果需要添加自定义参数，可以自定义一个函数返回请求参数
    sidePagination: "server",   //分页方式：client客户端分页，server服务端分页（*）
    minimumCountColumns: 2,    //最少允许的列数
    clickToSelect: false,    //是否启用点击选中行
    columns: [{
        field: 'id',
        title: 'id',
        align: 'center',
        visible:false
    },{
        field: 'preprice',
        title: 'preprice',
        align: 'center',
        visible:false
    },{
        field: 'net',
        title: 'net',
        align: 'center',
        visible:false
    },{
        field: 'fund_id',
        title: '基金编码',
        align: 'center',
        width:'5%',
        sortable: true
    },{
        field: 'name',
        title: '基金名称',
        align: 'center',
        width:'15%',
        sortable: true
    },{
        field: 'fTime',
        title: '订阅时间',
        align: 'center',
        width:'10%',
        sortable: true
    },{
        field: 'position_point',
        title: '持仓份额',
        align: 'center',
        width:'10%',
        sortable: true
    },{
        field: 'position_price',
        title: '持仓成本',
        align: 'center',
        width:'10%',
        sortable: true,
        formatter: function (value, row, index) {
        	if(value!=null)
        		return value+"元";
        	else
        		return "-";
        }
    },{
        field: 'callback',
        title: '止盈回调',
        align: 'center',
        width:'8%',
        sortable: true,
        formatter: function (value, row, index) {
        	if(value!=null)
        		return value+"%";
        	else
        		return "-";
        }
    },{
        field: 'enough',
        title: '止盈率',
        align: 'center',
        width:'8%',
        sortable: true,
        formatter: function (value, row, index) {
        	if(value!=null)
        		return value+"%";
        	else
        		return "-";
        }
    },{
        field: '收益率',
        title: '收益率',
        align: 'center',
        width:'8%',
        formatter: function (value, row, index) {
        	var position_point = row['position_point'];
        	var position_price = row['position_price'];
        	var net = row['net']
        	if((!position_point > 0)||(!position_price > 0)){
        		return "持仓信息待完善";
        	}
        	if(net == ""||net==null) net = row['preprice'];
        	if(net == ""){
        		return "上期净值暂无";
        	}
        	var x = (position_point*net-position_price)/position_price;
        	return Math.round(x * 10000) / 100+"%";
        }
    },{
        field: '收益',
        title: '收益',
        align: 'center',
        width:'8%',
        formatter: function (value, row, index) {
        	var position_point = row['position_point'];
        	var position_price = row['position_price'];
        	var net = row['net']
        	if((!position_point > 0)||(!position_price > 0)){
        		return "持仓信息待完善";
        	}
        	if(net == ""||net==null) net = row['preprice'];
        	if(net == ""){
        		return "上期净值暂无";
        	}
        	var x = position_point*net-position_price;
        	return Math.round(x * 100) / 100+"元";
        }
    } ]
});
function queryParams3(params) {  //配置参数 
	var temp = {   //这里的键的名字和控制器的变量名必须一直，这边改动，控制器也需要改成一样的  
	  	"pageSize": params.pageSize,   //页面大小  
	 	"pageNumber": params.pageNumber,  //页码    
		"paytime%t>":$("#timeStrBegin").val(),
		"paytime%t<":$("#timeStrEnd").val(),
		"paytype%i=":$("#paytype").val(),
		"userid%i=":userid,
	  	"sortName": params.sortName,  //排序列名  
	  	"sortOrder": params.sortOrder//排位命令（desc，asc）  
	};  
	return temp; 
}; 
	
$('#orderTable').bootstrapTable({
	method: 'post',
    contentType: "application/x-www-form-urlencoded",
    url: "order/getAllDatas",//这个接口需要处理bootstrap table传递的固定参数
    toolbar: '#toolbar2',    //工具按钮用哪个容器
    striped: true,      //是否显示行间隔色
    cache: false,      //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
    pagination: true,     //是否显示分页（*）
    onlyInfoPagination: false,
    sortable: true,      //是否启用排序
    sortOrder: "asc",     //排序方式
    sortName:"id",
    dataType: "json",
    pageNumber:1,      //初始化加载第一页，默认第一页
    pageSize: 10,      //每页的记录行数（*）
    pageList: [10, 25, 50, 100],  //可供选择的每页的行数（*）
    queryParamsType:'', //默认值为 'limit' ,在默认情况下 传给服务端的参数为：offset,limit,sort
    queryParams: queryParams3,//前端调用服务时，会默认传递上边提到的参数，如果需要添加自定义参数，可以自定义一个函数返回请求参数
    sidePagination: "server",   //分页方式：client客户端分页，server服务端分页（*）
    minimumCountColumns: 2,    //最少允许的列数
    clickToSelect: false,    //是否启用点击选中行
    columns: [{
        field: 'id',
        title: 'id',
        align: 'center',
        visible:false
    },{
        field: 'amount',
        title: '续费金额',
        align: 'center',
        width:'10%',
        sortable: true,
        formatter: function (value, row, index) {
        	if(value==0) return "免费";
        	else return value+"元";
        }
    },{
        field: 'ptime',
        title: '续费时间',
        align: 'center',
        width:'10%',
        sortable: true
    },{
        field: 'days',
        title: '续费时长',
        align: 'center',
        width:'10%',
        sortable: true,
        formatter: function (value, row, index) {
        	return value+"天";
        }
    },{
        field: 'paytype',
        title: '续费类型',
        align: 'center',
        width:'10%',
        formatter: function (value, row, index) {
        	if(value == 0) return "支付宝支付";
        	else if (value == -1) return "推荐新用户";
        	else if (value == -2) return "经推荐注册";
        }
    }],
    onLoadSuccess:function(data){
    	/* console.log($("#footpagebar"));
    	$("#footpagebar").attr("style","margin:0 auto"); */
    }
});
function queryParams2(params) {  //配置参数 
	var temp = {   //这里的键的名字和控制器的变量名必须一直，这边改动，控制器也需要改成一样的  
	  	"pageSize": params.pageSize,   //页面大小  
	 	"pageNumber": params.pageNumber,  //页码    
		"follow_time%t>":$("#timeStrBegin").val(),
		"follow_time%t<":$("#timeStrEnd").val(),
		"f.fund_id`t.name%s~":$("#searchFund").val(),
		"user_id%i=":userid,
	  	"sortName": params.sortName,  //排序列名  
	  	"sortOrder": params.sortOrder//排位命令（desc，asc）  
	};  
	return temp; 
};  
</script>
</html>